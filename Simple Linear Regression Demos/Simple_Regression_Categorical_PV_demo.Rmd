---
title: "Correlation and Simple Linear Regression Demo"
subtitle: "Categorical Predictor"
author: "Professor Christopher J. Schmank, PhD"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

### Required Libraries 

```{r}
library(tidyverse)
library(dplyr)
library(kableExtra)
library(psych)
library(jmv)
library(lm.beta) 
library(skimr)
library(broom)
library(moderndive)
library(gapminder)
```

### Next, load in the data stored in `gapminder` package

```{r}
gapminder2007 <- gapminder %>%
  filter(year == 2007) %>% 
  select(country, continent, lifeExp, gdpPercap)

```

### Exploratory Data Analysis

1. Observe raw data
1. Compute descriptive statistics
1. Visualize data

### Observe raw data

```{r}
head(gapminder2007)
#glimpse(gapminder2007)
#View(gapminder2007)

```

### Compute descriptive statistics

```{r}
# Can use any of these but my preference is the `describe()` function
describe(gapminder2007)

## These alternatives give you many descriptive stats but nothing about normality
# skim(gapminder2007)
# summary(gapminder2007)
# skim_without_charts(gapminder2007)

## Don't forget correlations --- Can make this work for character/factor variables!!
corrMatrix(gapminder2007,
           kendall = TRUE)

## By default corrMatrix() calculates Pearson's r BUT adding additional arguments
## Can provide subsequent assessments that do not require continuous variables
## spearman = TRUE --- allows for correlations among categorical variables
## kendall = TRUE --- allows for correlations among continuous/categorical variables

```

### Visualize the data

```{r}
## Histograms

ggplot(data = gapminder2007, 
       mapping = aes(x = lifeExp)) +
  geom_histogram(bins = 10, 
                 color = "seagreen", 
                 fill="black")

ggplot(data = gapminder2007, 
       mapping = aes(x = gdpPercap)) +
  geom_histogram(bins = 10, 
                 color = "seagreen", 
                 fill="black")

```

```{r}
## Side-by-Side Boxplot

ggplot(data = gapminder2007, 
       mapping = aes(y = lifeExp,
                     x = continent)) +
  geom_boxplot()

```

```{r}
## Scatterplot
# Visualization will not generate linear regression line so this has been removed from this visualization
ggplot(gapminder2007, 
       aes(x = continent, 
           y = lifeExp)) +
  geom_point() +
  labs(x = "Continent", 
       y = "Life Expectancy",
       title = "Relationship of Life Expectancy and Continent")

```


### Now lets run our simple linear regression (`lm()` workflow + `broom` package)
```{r}
lifeExp_model <- lm(lifeExp ~ continent, data = gapminder2007)

# Get regression table using `tidy()`:
tidy(lifeExp_model, conf.int=TRUE)

# Get model fit table using `glance()`:
glance(lifeExp_model)

```

### Alternatively we can use `linReg()` from the `jmv` package
```{r}
linReg(gapminder2007,         
       dep=lifeExp,             
       factors=continent,          
       blocks=list(           
         list('continent')),    
       anova=TRUE,            
       stdEst=TRUE,           
       ci=TRUE,               
       ciStdEst=TRUE)

```


### Lastly we should conduct a residual analysis
```{r}

regression_points <- get_regression_points(lifeExp_model)

# Scatterplot of Explanatory Variable along x-axis and Residuals along y-axis
ggplot(regression_points, 
       aes(x = continent, y = residual)) +
  geom_jitter(width = 0.1) +
  labs(x = "Continent", y = "Residual") +
  geom_hline(yintercept = 0, col = "blue", size = 1)

# Additionally we want to look at the distribution of residuals
ggplot(regression_points, 
       aes(x = residual)) +
  geom_histogram(bins = 10, color = "forestgreen") +
  labs(x = "Residual")

describe(regression_points$residual)

```
